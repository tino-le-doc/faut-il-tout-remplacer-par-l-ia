<!--
  Copyright (c) 2025 Tino Le Doc - Tous droits reserves
  Toute copie, reproduction ou reutilisation non autorisee est interdite.
  Licence proprietaire - voir fichier LICENSE
-->
<!DOCTYPE html>
<html lang="fr">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8612974241235499"
         crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="author" content="Tino Le Doc">
    <meta name="copyright" content="Copyright 2025 Tino Le Doc. Tous droits reserves.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Compte üë§ Tino Le Doc</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-secondary: #12121a;
            --cyan: #00f5ff;
            --magenta: #ff00aa;
            --yellow: #f5ff00;
            --orange: #ff9500;
            --green: #00ff88;
            --red: #ff4444;
            --text: #e8e8e8;
            --text-secondary: #a0a0a0;
            --glass: rgba(255,255,255,0.05);
            --glass-border: rgba(255,255,255,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .bg-grid {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(0, 245, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 245, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .logo { text-align: center; padding: 20px 0; }
        .logo img { max-width: 120px; filter: drop-shadow(0 5px 20px rgba(255,165,0,0.4)); }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--cyan);
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        .back-link:hover { text-decoration: underline; }

        header { text-align: center; margin-bottom: 30px; }
        header h1 {
            font-family: 'Syne', sans-serif;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--cyan), var(--magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Stats boxes */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        .stat-box.visits { border-color: var(--cyan); }
        .stat-box.members { border-color: var(--magenta); }
        .stat-icon { font-size: 2rem; margin-bottom: 10px; }
        .stat-number {
            font-family: 'Syne', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--cyan), var(--magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label { font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px; }

        /* Auth container */
        .auth-container {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
        }

        /* Tabs */
        .auth-tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .auth-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text);
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .auth-tab:hover { border-color: rgba(255,255,255,0.2); }
        .auth-tab.active {
            background: linear-gradient(135deg, var(--magenta), var(--cyan));
            border-color: transparent;
        }

        /* Forms */
        .auth-form { display: none; }
        .auth-form.active { display: block; }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
        }
        .form-group input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--cyan);
            box-shadow: 0 0 20px rgba(0,245,255,0.2);
        }
        .form-group input::placeholder { color: rgba(255,255,255,0.3); }

        .password-toggle { position: relative; }
        .password-toggle input { padding-right: 50px; }
        .toggle-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--cyan);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .form-error {
            display: none;
            padding: 12px 15px;
            background: rgba(255,68,68,0.15);
            border: 1px solid var(--red);
            border-radius: 10px;
            color: var(--red);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .form-error.show { display: block; }

        .form-success {
            display: none;
            padding: 12px 15px;
            background: rgba(0,255,136,0.15);
            border: 1px solid var(--green);
            border-radius: 10px;
            color: var(--green);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .form-success.show { display: block; }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--magenta), var(--cyan));
            border: none;
            border-radius: 12px;
            color: #fff;
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255,0,170,0.4);
        }
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .forgot-link {
            display: block;
            text-align: center;
            margin-top: 15px;
            color: var(--cyan);
            font-size: 0.9rem;
            cursor: pointer;
        }
        .forgot-link:hover { text-decoration: underline; }

        /* Separateur "ou" */
        .auth-divider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--glass-border);
        }

        /* Bouton Google */
        .google-btn {
            width: 100%;
            padding: 14px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .google-btn:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .google-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .google-btn svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        /* Modal pseudo Google */
        .pseudo-modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .pseudo-modal-overlay.active { display: flex; }
        .pseudo-modal {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
        }
        .pseudo-modal h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--cyan), var(--magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .pseudo-modal p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* Profile (logged in) */
        .profile-container { display: none; }
        .profile-container.active { display: block; }

        .profile-header { text-align: center; margin-bottom: 25px; }
        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--magenta), var(--cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 800;
            color: var(--bg);
            margin: 0 auto 15px;
        }
        .profile-name {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            color: var(--text);
        }
        .profile-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .profile-badge {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(135deg, var(--green), var(--cyan));
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--bg);
            margin-top: 10px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
        }
        .profile-stat { text-align: center; }
        .profile-stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--cyan);
        }
        .profile-stat-label { font-size: 0.75rem; color: var(--text-secondary); }

        .profile-actions { display: flex; flex-direction: column; gap: 10px; }
        .profile-btn {
            padding: 12px 20px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            text-decoration: none;
        }
        .profile-btn:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--cyan);
        }
        .profile-btn.danger { border-color: var(--red); color: var(--red); }
        .profile-btn.danger:hover { background: rgba(255,68,68,0.15); }

        /* Notification preferences */
        .notif-prefs {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
        }

        .notif-prefs h4 {
            font-family: 'Syne', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--cyan);
        }

        .notif-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .notif-toggle:last-child {
            border-bottom: none;
        }

        .notif-toggle-info {
            flex: 1;
        }

        .notif-toggle-label {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }

        .notif-toggle-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
            margin-left: 15px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.15);
            border-radius: 28px;
            transition: all 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--magenta), var(--cyan));
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(22px);
        }

        .notif-status {
            font-size: 0.8rem;
            color: var(--green);
            margin-top: 10px;
            display: none;
        }

        .notif-status.show {
            display: block;
        }

        /* Loading */
        .loading { display: none; text-align: center; padding: 40px; }
        .loading.active { display: block; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Password strength */
        .password-strength {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            border-radius: 2px;
        }
        .password-strength-bar.weak { width: 33%; background: var(--red); }
        .password-strength-bar.medium { width: 66%; background: var(--orange); }
        .password-strength-bar.strong { width: 100%; background: var(--green); }
        .password-hint { font-size: 0.75rem; color: var(--text-secondary); margin-top: 5px; }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        footer a { color: var(--cyan); text-decoration: none; }
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Aller au contenu</a>
    <div class="bg-grid"></div>

    <div class="container">
        <div class="logo">
            <a href="index.html"><img src="img/1000074494.png" alt="Tino Le Doc"></a>
        </div>
        <a href="index.html" class="back-link">‚Üê Retour √† l'accueil</a>

        <header id="main-content">
            <h1>üë§ Mon Compte</h1>
        </header>

        <!-- Stats publics -->
        <div class="stats">
            <div class="stat-box visits">
                <div class="stat-icon">üëÅÔ∏è</div>
                <div class="stat-number" id="visitCount">--</div>
                <div class="stat-label">Visites totales</div>
            </div>
            <div class="stat-box members">
                <div class="stat-icon">üë•</div>
                <div class="stat-number" id="memberCount">--</div>
                <div class="stat-label">Membres inscrits</div>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Chargement...</p>
        </div>

        <!-- Auth Forms -->
        <div class="auth-container" id="authContainer">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">üîë Connexion</button>
                <button class="auth-tab" data-tab="register">‚ú® Inscription</button>
            </div>

            <div class="form-error" id="formError"></div>
            <div class="form-success" id="formSuccess"></div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm" aria-label="Formulaire de connexion">
                <div class="form-group">
                    <label>üìß Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label>üîí Mot de passe</label>
                    <div class="password-toggle">
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
                        <button type="button" class="toggle-btn" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="submit-btn" id="loginBtn">Se connecter</button>
                <span class="forgot-link" onclick="resetPassword()">Mot de passe oubli√© ?</span>
                <div class="auth-divider">ou</div>
                <button type="button" class="google-btn" onclick="signInWithGoogle()">
                    <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Continuer avec Google
                </button>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm" aria-label="Formulaire d'inscription">
                <div class="form-group">
                    <label>üë§ Pseudo</label>
                    <input type="text" id="regPseudo" placeholder="TonPseudo" required minlength="3" maxlength="20" autocomplete="username">
                    <div class="password-hint">3-20 caract√®res, lettres, chiffres et _ uniquement</div>
                </div>
                <div class="form-group">
                    <label>üìß Email</label>
                    <input type="email" id="regEmail" placeholder="votre@email.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label>üîí Mot de passe</label>
                    <div class="password-toggle">
                        <input type="password" id="regPassword" placeholder="Min. 6 caract√®res" required minlength="6" autocomplete="new-password">
                        <button type="button" class="toggle-btn" onclick="togglePassword('regPassword', this)">üëÅÔ∏è</button>
                    </div>
                    <div class="password-strength">
                        <div class="password-strength-bar" id="strengthBar"></div>
                    </div>
                    <div class="password-hint">Min. 6 caract√®res (recommand√©: majuscule + chiffre + symbole)</div>
                </div>
                <div class="form-group">
                    <label>üîí Confirmer le mot de passe</label>
                    <div class="password-toggle">
                        <input type="password" id="regPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="new-password">
                        <button type="button" class="toggle-btn" onclick="togglePassword('regPasswordConfirm', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="submit-btn" id="registerBtn">Cr√©er mon compte</button>
                <div class="auth-divider">ou</div>
                <button type="button" class="google-btn" onclick="signInWithGoogle()">
                    <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    S'inscrire avec Google
                </button>
            </form>
        </div>

        <!-- Modal choix pseudo pour Google -->
        <div class="pseudo-modal-overlay" id="pseudoModal">
            <div class="pseudo-modal">
                <h3>Bienvenue !</h3>
                <p>Choisissez un pseudo pour votre profil :</p>
                <div class="form-error" id="pseudoError"></div>
                <div class="form-group">
                    <input type="text" id="googlePseudo" placeholder="TonPseudo" minlength="3" maxlength="20" autocomplete="username">
                    <div class="password-hint">3-20 caract√®res, lettres, chiffres et _ uniquement</div>
                </div>
                <button class="submit-btn" id="savePseudoBtn" onclick="saveGooglePseudo()">Valider mon pseudo</button>
            </div>
        </div>

        <!-- Profile (when logged in) -->
        <div class="auth-container profile-container" id="profileContainer">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">?</div>
                <div class="profile-name" id="profileName">Chargement...</div>
                <div class="profile-email" id="profileEmail"></div>
                <div class="profile-badge">‚ú® Membre</div>
            </div>

            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="userMessages">0</div>
                    <div class="profile-stat-label">Messages</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="userAvis">0</div>
                    <div class="profile-stat-label">Avis</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="userDays">0</div>
                    <div class="profile-stat-label">Jours</div>
                </div>
            </div>

            <!-- Pr√©f√©rences de notifications -->
            <div class="notif-prefs">
                <h4>üîî Notifications</h4>
                <div class="notif-toggle">
                    <div class="notif-toggle-info">
                        <div class="notif-toggle-label">üìß Notifications par email</div>
                        <div class="notif-toggle-desc">Recevoir un email quand vous avez des messages ou demandes de contact en attente</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="emailNotifToggle" onchange="toggleEmailNotifications(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="notif-toggle">
                    <div class="notif-toggle-info">
                        <div class="notif-toggle-label">üîî Notifications navigateur</div>
                        <div class="notif-toggle-desc">Recevoir des alertes m√™me quand l'onglet est en arri√®re-plan</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="browserNotifToggle" onchange="toggleBrowserNotifications(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="notif-status" id="notifStatus"></div>
            </div>

            <div class="profile-actions">
                <a href="tchat.html" class="profile-btn">üí¨ Aller au tchat</a>
                <a href="messagerie.html" class="profile-btn">‚úâÔ∏è Messagerie priv√©e</a>
                <button class="profile-btn danger" onclick="logout()">üö™ D√©connexion</button>
            </div>
        </div>

        <footer role="contentinfo">
            <p><strong>Tino Le Doc</strong> - L'IA qui t'√©coute</p>
            <div class="footer-links">
                <a href="index.html">üè† Accueil</a>
                <a href="tchat.html">üí¨ Tchat</a>
                <a href="messagerie.html">‚úâÔ∏è Messagerie</a>
                <a href="confidentialite.html">üîí Confidentialit√©</a>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
    // ==================== FIREBASE INIT ====================
    // Config Firebase chargee depuis js/firebase-config.js
    const auth = firebaseAuth;
    const db = firebaseDb;

    if (!firebaseDb) {
        document.getElementById('formError').textContent = 'Erreur de connexion au serveur. Rechargez la page.';
        document.getElementById('formError').classList.add('show');
    }

    // ==================== DOM ELEMENTS ====================
    const loading = document.getElementById('loading');
    const authContainer = document.getElementById('authContainer');
    const profileContainer = document.getElementById('profileContainer');
    const formError = document.getElementById('formError');
    const formSuccess = document.getElementById('formSuccess');

    // ==================== LOAD COUNTERS ====================
    function loadCounters() {
        try {
            // Visits
            db.ref('counters/visits').on('value', snapshot => {
                const count = snapshot.val() || 0;
                document.getElementById('visitCount').textContent = count.toLocaleString('fr-FR');
            }, error => {
                console.error('Erreur compteur visites:', error);
            });

            // Members
            db.ref('counters/subscribers').on('value', snapshot => {
                const count = snapshot.val() || 0;
                document.getElementById('memberCount').textContent = count.toLocaleString('fr-FR');
            }, error => {
                console.error('Erreur compteur membres:', error);
            });
        } catch (error) {
            console.error('Erreur chargement compteurs:', error);
        }
    }

    // ==================== AUTH STATE ====================
    auth.onAuthStateChanged(async (user) => {
        console.log('üë§ Auth state changed:', user ? user.email : 'non connect√©');
        loading.classList.remove('active');

        if (user) {
            // User is logged in
            authContainer.style.display = 'none';
            profileContainer.classList.add('active');

            try {
                const snapshot = await db.ref('users/' + user.uid).once('value');
                const profile = snapshot.val();

                if (profile) {
                    document.getElementById('profileAvatar').textContent = profile.pseudo ? profile.pseudo.charAt(0).toUpperCase() : '?';
                    document.getElementById('profileName').textContent = profile.pseudo || 'Utilisateur';
                    document.getElementById('profileEmail').textContent = user.email;
                    document.getElementById('userMessages').textContent = profile.messagesCount || 0;
                    document.getElementById('userAvis').textContent = profile.avisCount || 0;

                    // Calculate days since registration
                    if (profile.createdAt) {
                        const days = Math.floor((Date.now() - profile.createdAt) / (1000 * 60 * 60 * 24));
                        document.getElementById('userDays').textContent = days;
                    }

                    // Charger les pr√©f√©rences de notifications
                    loadNotificationPrefs(user.uid);
                } else {
                    document.getElementById('profileName').textContent = user.email;
                }
            } catch (error) {
                console.error('Erreur chargement profil:', error);
                document.getElementById('profileName').textContent = user.email;
            }
        } else {
            // User is not logged in
            authContainer.style.display = 'block';
            profileContainer.classList.remove('active');
        }
    });

    // ==================== TABS ====================
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            this.classList.add('active');
            const formId = this.dataset.tab + 'Form';
            document.getElementById(formId).classList.add('active');
            hideMessages();
        });
    });

    // ==================== PASSWORD TOGGLE ====================
    function togglePassword(inputId, btn) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            btn.textContent = 'üôà';
        } else {
            input.type = 'password';
            btn.textContent = 'üëÅÔ∏è';
        }
    }

    // ==================== PASSWORD STRENGTH ====================
    document.getElementById('regPassword').addEventListener('input', function() {
        const bar = document.getElementById('strengthBar');
        const password = this.value;
        let strength = 0;

        if (password.length >= 6) strength++;
        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        bar.className = 'password-strength-bar';
        if (strength >= 4) bar.classList.add('strong');
        else if (strength >= 2) bar.classList.add('medium');
        else if (strength >= 1) bar.classList.add('weak');
    });

    // ==================== MESSAGES ====================
    function showError(msg) {
        formError.textContent = msg;
        formError.classList.add('show');
        formSuccess.classList.remove('show');
    }

    function showSuccess(msg) {
        formSuccess.textContent = msg;
        formSuccess.classList.add('show');
        formError.classList.remove('show');
    }

    function hideMessages() {
        formError.classList.remove('show');
        formSuccess.classList.remove('show');
    }

    // ==================== VALIDATION ====================
    function validatePseudo(pseudo) {
        if (pseudo.length < 3 || pseudo.length > 20) return false;
        if (!/^[a-zA-Z0-9_]+$/.test(pseudo)) return false;
        return true;
    }

    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePassword(password) {
        return password.length >= 6; // Firebase minimum is 6
    }

    // ==================== REGISTER ====================
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        hideMessages();

        const pseudo = document.getElementById('regPseudo').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        const passwordConfirm = document.getElementById('regPasswordConfirm').value;
        const btn = document.getElementById('registerBtn');

        // Validations
        if (!validatePseudo(pseudo)) {
            showError('Pseudo invalide (3-20 caract√®res, lettres/chiffres/_ uniquement)');
            return;
        }

        if (!validateEmail(email)) {
            showError('Adresse email invalide');
            return;
        }

        if (!validatePassword(password)) {
            showError('Mot de passe trop court (minimum 6 caract√®res)');
            return;
        }

        if (password !== passwordConfirm) {
            showError('Les mots de passe ne correspondent pas');
            return;
        }

        btn.disabled = true;
        btn.textContent = '‚è≥ Cr√©ation en cours...';

        try {
            console.log('üìù Tentative inscription:', email);

            // Check if pseudo exists
            const pseudoSnapshot = await db.ref('pseudos/' + pseudo.toLowerCase()).once('value');
            if (pseudoSnapshot.exists()) {
                showError('Ce pseudo est d√©j√† pris. Choisissez-en un autre.');
                btn.disabled = false;
                btn.textContent = 'Cr√©er mon compte';
                return;
            }

            // Create account
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            console.log('‚úÖ Compte cr√©√©:', user.uid);

            // Save profile
            await db.ref('users/' + user.uid).set({
                pseudo: pseudo,
                email: email,
                createdAt: Date.now(),
                messagesCount: 0,
                avisCount: 0
            });

            // Reserve pseudo
            await db.ref('pseudos/' + pseudo.toLowerCase()).set(user.uid);

            // Increment member counter
            await db.ref('counters/subscribers').transaction(count => (count || 0) + 1);

            console.log('‚úÖ Profil sauvegard√©');
            showSuccess('üéâ Compte cr√©√© avec succ√®s ! Bienvenue ' + pseudo);

        } catch (error) {
            console.error('‚ùå Erreur inscription:', error.code, error.message);

            let msg = 'Erreur lors de l\'inscription';
            switch (error.code) {
                case 'auth/email-already-in-use':
                    msg = 'Cette adresse email est d√©j√† utilis√©e';
                    break;
                case 'auth/weak-password':
                    msg = 'Mot de passe trop faible (minimum 6 caract√®res)';
                    break;
                case 'auth/invalid-email':
                    msg = 'Adresse email invalide';
                    break;
                case 'auth/network-request-failed':
                    msg = 'Erreur r√©seau. V√©rifiez votre connexion internet.';
                    break;
                case 'auth/operation-not-allowed':
                    msg = 'L\'inscription par email n\'est pas activ√©e. Contactez l\'administrateur.';
                    break;
                case 'auth/too-many-requests':
                    msg = 'Trop de tentatives. R√©essayez dans quelques minutes.';
                    break;
                default:
                    msg = error.message || 'Erreur inconnue';
            }
            showError(msg);
        }

        btn.disabled = false;
        btn.textContent = 'Cr√©er mon compte';
    });

    // ==================== LOGIN ====================
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        hideMessages();

        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const btn = document.getElementById('loginBtn');

        if (!validateEmail(email)) {
            showError('Adresse email invalide');
            return;
        }

        if (!password) {
            showError('Entrez votre mot de passe');
            return;
        }

        btn.disabled = true;
        btn.textContent = '‚è≥ Connexion...';

        try {
            console.log('üîê Tentative connexion:', email);
            await auth.signInWithEmailAndPassword(email, password);
            console.log('‚úÖ Connexion r√©ussie');
            showSuccess('üéâ Connexion r√©ussie !');

        } catch (error) {
            console.error('‚ùå Erreur connexion:', error.code, error.message);

            let msg = 'Erreur de connexion';
            switch (error.code) {
                case 'auth/user-not-found':
                    msg = 'Aucun compte trouv√© avec cette adresse email';
                    break;
                case 'auth/wrong-password':
                    msg = 'Mot de passe incorrect';
                    break;
                case 'auth/invalid-credential':
                    msg = 'Email ou mot de passe incorrect';
                    break;
                case 'auth/invalid-email':
                    msg = 'Adresse email invalide';
                    break;
                case 'auth/user-disabled':
                    msg = 'Ce compte a √©t√© d√©sactiv√©';
                    break;
                case 'auth/too-many-requests':
                    msg = 'Trop de tentatives √©chou√©es. R√©essayez plus tard ou r√©initialisez votre mot de passe.';
                    break;
                case 'auth/network-request-failed':
                    msg = 'Erreur r√©seau. V√©rifiez votre connexion internet.';
                    break;
                default:
                    msg = error.message || 'Erreur inconnue';
            }
            showError(msg);
        }

        btn.disabled = false;
        btn.textContent = 'Se connecter';
    });

    // ==================== PASSWORD RESET ====================
    async function resetPassword() {
        const email = document.getElementById('loginEmail').value.trim();

        if (!email) {
            showError('Entrez d\'abord votre adresse email');
            return;
        }

        if (!validateEmail(email)) {
            showError('Adresse email invalide');
            return;
        }

        try {
            await auth.sendPasswordResetEmail(email);
            showSuccess('üìß Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte mail.');
        } catch (error) {
            console.error('‚ùå Erreur reset:', error.code, error.message);

            let msg = 'Erreur lors de l\'envoi';
            switch (error.code) {
                case 'auth/user-not-found':
                    msg = 'Aucun compte trouv√© avec cette adresse email';
                    break;
                case 'auth/invalid-email':
                    msg = 'Adresse email invalide';
                    break;
                case 'auth/too-many-requests':
                    msg = 'Trop de demandes. R√©essayez plus tard.';
                    break;
                default:
                    msg = error.message || 'Erreur inconnue';
            }
            showError(msg);
        }
    }

    // ==================== LOGOUT ====================
    async function logout() {
        try {
            await auth.signOut();
            console.log('‚úÖ D√©connexion');
            showSuccess('Vous avez √©t√© d√©connect√©');
        } catch (error) {
            console.error('‚ùå Erreur d√©connexion:', error);
            showError('Erreur lors de la d√©connexion');
        }
    }

    // ==================== GOOGLE SIGN-IN ====================
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    let pendingGoogleUser = null;

    async function signInWithGoogle() {
        hideMessages();
        const btns = document.querySelectorAll('.google-btn');
        btns.forEach(b => { b.disabled = true; b.querySelector('svg').style.display = 'none'; });

        try {
            const result = await auth.signInWithPopup(googleProvider);
            const user = result.user;
            console.log('Google sign-in:', user.uid);

            // Verifier si le profil existe deja
            const snapshot = await db.ref('users/' + user.uid).once('value');
            if (snapshot.exists()) {
                // Utilisateur existant - connexion directe
                console.log('Utilisateur Google existant');
                showSuccess('Connexion reussie !');
            } else {
                // Nouvel utilisateur - demander un pseudo
                pendingGoogleUser = user;
                const suggested = (user.displayName || user.email.split('@')[0])
                    .replace(/[^a-zA-Z0-9_]/g, '_').substring(0, 20);
                document.getElementById('googlePseudo').value = suggested;
                document.getElementById('pseudoModal').classList.add('active');
            }
        } catch (error) {
            console.error('Erreur Google:', error.code, error.message);
            if (error.code === 'auth/popup-closed-by-user') {
                // L'utilisateur a ferme la popup, pas d'erreur a afficher
            } else if (error.code === 'auth/popup-blocked') {
                showError('Popup bloquee par le navigateur. Autorisez les popups pour ce site.');
            } else if (error.code === 'auth/cancelled-popup-request') {
                // Ignore
            } else {
                showError('Erreur de connexion Google : ' + (error.message || 'Erreur inconnue'));
            }
        }

        btns.forEach(b => { b.disabled = false; b.querySelector('svg').style.display = ''; });
    }

    async function saveGooglePseudo() {
        if (!pendingGoogleUser) return;

        const pseudo = document.getElementById('googlePseudo').value.trim();
        const errorEl = document.getElementById('pseudoError');
        const btn = document.getElementById('savePseudoBtn');

        errorEl.classList.remove('show');

        if (!validatePseudo(pseudo)) {
            errorEl.textContent = 'Pseudo invalide (3-20 caracteres, lettres/chiffres/_ uniquement)';
            errorEl.classList.add('show');
            return;
        }

        btn.disabled = true;
        btn.textContent = 'Verification...';

        try {
            // Verifier unicite du pseudo
            const pseudoSnapshot = await db.ref('pseudos/' + pseudo.toLowerCase()).once('value');
            if (pseudoSnapshot.exists()) {
                errorEl.textContent = 'Ce pseudo est deja pris. Choisissez-en un autre.';
                errorEl.classList.add('show');
                btn.disabled = false;
                btn.textContent = 'Valider mon pseudo';
                return;
            }

            // Creer le profil
            await db.ref('users/' + pendingGoogleUser.uid).set({
                pseudo: pseudo,
                email: pendingGoogleUser.email,
                createdAt: Date.now(),
                messagesCount: 0,
                avisCount: 0
            });

            // Reserver le pseudo
            await db.ref('pseudos/' + pseudo.toLowerCase()).set(pendingGoogleUser.uid);

            // Incrementer le compteur de membres
            await db.ref('counters/subscribers').transaction(count => (count || 0) + 1);

            // Fermer la modal
            document.getElementById('pseudoModal').classList.remove('active');
            pendingGoogleUser = null;
            showSuccess('Compte cree avec succes ! Bienvenue ' + pseudo);

        } catch (error) {
            console.error('Erreur sauvegarde pseudo:', error);
            errorEl.textContent = 'Erreur lors de la sauvegarde. Reessayez.';
            errorEl.classList.add('show');
        }

        btn.disabled = false;
        btn.textContent = 'Valider mon pseudo';
    }

    // ==================== NOTIFICATION PREFERENCES ====================
    async function loadNotificationPrefs(uid) {
        try {
            // Email notifications
            const emailSnap = await db.ref('users/' + uid + '/emailNotifications').once('value');
            const emailToggle = document.getElementById('emailNotifToggle');
            if (emailToggle) {
                emailToggle.checked = emailSnap.val() !== false; // Activ√© par d√©faut
            }

            // Browser notifications
            const browserToggle = document.getElementById('browserNotifToggle');
            if (browserToggle) {
                browserToggle.checked = 'Notification' in window && Notification.permission === 'granted';
            }
        } catch (e) {
            console.error('Erreur chargement pr√©f√©rences notif:', e);
        }
    }

    async function toggleEmailNotifications(enabled) {
        const user = auth.currentUser;
        if (!user) return;

        try {
            await db.ref('users/' + user.uid + '/emailNotifications').set(enabled);
            showNotifStatus(enabled
                ? 'üìß Notifications email activ√©es'
                : 'üìß Notifications email d√©sactiv√©es');
        } catch (e) {
            console.error('Erreur toggle email notif:', e);
            showNotifStatus('Erreur lors de la sauvegarde', true);
        }
    }

    async function toggleBrowserNotifications(enabled) {
        if (!('Notification' in window)) {
            showNotifStatus('Votre navigateur ne supporte pas les notifications', true);
            document.getElementById('browserNotifToggle').checked = false;
            return;
        }

        if (enabled) {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                showNotifStatus('üîî Notifications navigateur activ√©es');
            } else {
                document.getElementById('browserNotifToggle').checked = false;
                showNotifStatus('Notifications bloqu√©es. Autorisez-les dans les param√®tres du navigateur.', true);
            }
        } else {
            showNotifStatus('üîî Notifications navigateur d√©sactiv√©es (modifiable dans les param√®tres navigateur)');
        }
    }

    function showNotifStatus(msg, isError) {
        const el = document.getElementById('notifStatus');
        if (!el) return;
        el.textContent = msg;
        el.style.color = isError ? 'var(--red)' : 'var(--green)';
        el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 4000);
    }

    // ==================== INIT ====================
    loadCounters();
    </script>
</body>
</html>
